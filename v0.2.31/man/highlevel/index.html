<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>High-level API · JutulDarcy.jl</title><meta name="title" content="High-level API · JutulDarcy.jl"/><meta property="og:title" content="High-level API · JutulDarcy.jl"/><meta property="twitter:title" content="High-level API · JutulDarcy.jl"/><meta name="description" content="Documentation for JutulDarcy.jl."/><meta property="og:description" content="Documentation for JutulDarcy.jl."/><meta property="twitter:description" content="Documentation for JutulDarcy.jl."/><meta property="og:url" content="https://sintefmath.github.io/JutulDarcy.jl/man/highlevel/"/><meta property="twitter:url" content="https://sintefmath.github.io/JutulDarcy.jl/man/highlevel/"/><link rel="canonical" href="https://sintefmath.github.io/JutulDarcy.jl/man/highlevel/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="JutulDarcy.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">JutulDarcy.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><span class="tocitem">Introduction</span><ul><li><a class="tocitem" href="../../">JutulDarcy.jl</a></li><li><a class="tocitem" href="../intro/">Getting started</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/two_phase_gravity_segregation/">Gravity segregation</a></li><li><a class="tocitem" href="../../examples/two_phase_buckley_leverett/">Two-phase Buckley-Leverett</a></li><li><a class="tocitem" href="../../examples/two_phase_unstable_gravity/">Gravity circulation with CPR preconditioner</a></li><li><a class="tocitem" href="../../examples/wells_intro/">Intro to wells</a></li><li><a class="tocitem" href="../../examples/intro_sensitivities/">Intro to sensitivities in JutulDarcy</a></li><li><a class="tocitem" href="../../examples/co2_sloped/">CO2 injection in saline aquifer</a></li><li><a class="tocitem" href="../../examples/data_input_file/">Simulating Eclipse/DATA input files</a></li><li><a class="tocitem" href="../../examples/five_spot_ensemble/">Quarter-five-spot with variation</a></li><li><a class="tocitem" href="../../examples/co2_brine_2d_vertical/">Intro to compositional flow</a></li><li><a class="tocitem" href="../../examples/compositional_5components/">Compositional with five components</a></li><li><a class="tocitem" href="../../examples/optimize_simple_bl/">Parameter optimization of Buckley-Leverett</a></li><li><a class="tocitem" href="../../examples/validation_spe1/">Validation: SPE1</a></li><li><a class="tocitem" href="../../examples/validation_spe9/">Validation: SPE9</a></li><li><a class="tocitem" href="../../examples/validation_compositional/">Validation: Compositional</a></li><li><a class="tocitem" href="../../examples/validation_egg/">Validation: Egg</a></li><li><a class="tocitem" href="../../examples/validation_olympus_1/">Validation: OLYMPUS 1</a></li><li><a class="tocitem" href="../../examples/validation_norne_nohyst/">Validation: Norne</a></li><li><a class="tocitem" href="../../examples/validation_mrst/">Validation: MRST input files</a></li></ul></li><li><span class="tocitem">Manual</span><ul><li class="is-active"><a class="tocitem" href>High-level API</a><ul class="internal"><li><a class="tocitem" href="#Setup"><span>Setup</span></a></li><li><a class="tocitem" href="#Simulation"><span>Simulation</span></a></li></ul></li><li><a class="tocitem" href="../basics/input_files/">Input formats</a></li><li><a class="tocitem" href="../basics/forces/">Driving forces</a></li><li><a class="tocitem" href="../basics/systems/">Supported physical systems</a></li><li><a class="tocitem" href="../basics/wells/">Wells and controls</a></li><li><a class="tocitem" href="../basics/solution/">Solving the equations</a></li><li><a class="tocitem" href="../basics/primary/">Primary variables</a></li><li><a class="tocitem" href="../basics/secondary/">Secondary variables (properties)</a></li><li><a class="tocitem" href="../basics/parameters/">Parameters</a></li><li><a class="tocitem" href="../basics/plotting/">Plotting and visualization</a></li></ul></li><li><span class="tocitem">Advanced usage</span><ul><li><a class="tocitem" href="../advanced/mpi/">Multi-threading and MPI support</a></li><li><a class="tocitem" href="../advanced/compiled/">Standalone reservoir simulator</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../../ref/jutul/">Jutul functions</a></li></ul></li><li><span class="tocitem">Additional information </span><ul><li><a class="tocitem" href="../../extras/refs/">References</a></li><li><a class="tocitem" href="../../extras/faq/">FAQ</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>High-level API</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>High-level API</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/sintefmath/JutulDarcy.jl/blob/main/docs/src/man/highlevel.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="High-level-API"><a class="docs-heading-anchor" href="#High-level-API">High-level API</a><a id="High-level-API-1"></a><a class="docs-heading-anchor-permalink" href="#High-level-API" title="Permalink"></a></h1><h2 id="Setup"><a class="docs-heading-anchor" href="#Setup">Setup</a><a id="Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Setup" title="Permalink"></a></h2><h3 id="Meshes"><a class="docs-heading-anchor" href="#Meshes">Meshes</a><a id="Meshes-1"></a><a class="docs-heading-anchor-permalink" href="#Meshes" title="Permalink"></a></h3><p>JutulDarcy can use meshes that supported by Jutul. This includes the Cartesian and Unstructured meshes as well as any meshes in the more general <a href="https://github.com/JuliaGeometry/Meshes.jl">Meshes.jl</a> package.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jutul.CartesianMesh" href="#Jutul.CartesianMesh"><code>Jutul.CartesianMesh</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">CartesianMesh(dims, [Δ, [origin]])</code></pre><p>Create a Cartesian mesh with dimensions specified by the <code>Tuple</code> <code>dims</code>.</p><p><strong>Arguments</strong></p><ul><li><code>dims::Tuple</code>: Number of grid cells in each direction. For example, <code>(nx, ny)</code> will give a 2D grids with <code>nx</code> cells in the x-direction.</li><li><code>Δ::Tuple=ones(length(dims))</code>: Equal length to <code>dims</code>. First option: A <code>Tuple</code> of scalars where each entry is the length of each cell in that direction. For</li></ul><p>example, specifying <code>(Δx, Δy) for a uniform grid with each grid cell having area of</code>Δx*Δy<code>. Second option: A</code>Tuple` of vectors where each entry contains the cell sizes in the direction.</p><ul><li><code>origin=zeros(length(dims))</code>: The origin of the first corner in the grid.</li></ul><p><strong>Examples</strong></p><p>Generate a uniform 3D mesh that discretizes a domain of 2 by 3 by 5 units with 3 by 5 by 2 cells:</p><pre><code class="language-julia-repl hljs">julia&gt; CartesianMesh((3, 5, 2), (2.0, 3.0, 5.0))
CartesianMesh (3D) with 3x5x2=30 cells</code></pre><p>Generate a non-uniform 2D mesh:</p><pre><code class="language-julia-repl hljs">julia&gt; CartesianMesh((2, 3), ([1.0, 2.0], [0.1, 3.0, 2.5]))
CartesianMesh (3D) with 3x5x2=30 cells</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/v0.2.37/src/meshes/cart.jl#L3-L27">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Jutul.UnstructuredMesh" href="#Jutul.UnstructuredMesh"><code>Jutul.UnstructuredMesh</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">UnstructuredMesh(g::CartesianMesh)</code></pre><p>Convert <code>CartesianMesh</code> instance to unstructured grid. Note that the mesh must be 2D and 3D for a 1-to-1 conversion. 1D meshes are implicitly converted to 2D.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/Jutul.jl/blob/v0.2.37/src/meshes/unstructured/types.jl#L289-L294">source</a></section></article><h3 id="Reservoir"><a class="docs-heading-anchor" href="#Reservoir">Reservoir</a><a id="Reservoir-1"></a><a class="docs-heading-anchor-permalink" href="#Reservoir" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JutulDarcy.reservoir_domain" href="#JutulDarcy.reservoir_domain"><code>JutulDarcy.reservoir_domain</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">reservoir_domain(g; permeability = convert_to_si(0.1, :darcy), porosity = 0.1, kwarg...)</code></pre><p>Set up a <code>DataDomain</code> instance for given mesh or other representation <code>g</code>. <code>permeability</code> and <code>porosity</code> are then added to the domain. If scalars are passed, they are expanded to cover all cells. Arrays are asserted to match all cells. Permeability is either one value per cell (diagonal scalar), one value per dimension given in each row (for a diagonal tensor) or a vector that represents a compact full tensor representation (6 elements in 3D, 3 in 2D).</p><p><strong>Default data and their values</strong></p><table><tr><th style="text-align: right">Name</th><th style="text-align: right">Explanation</th><th style="text-align: right">Unit</th><th style="text-align: right">Default</th></tr><tr><td style="text-align: right"><code>permeability</code></td><td style="text-align: right">Rock ability to conduct fluid flow</td><td style="text-align: right"><span>$m^2$</span></td><td style="text-align: right">100 mD</td></tr><tr><td style="text-align: right"><code>porosity</code></td><td style="text-align: right">Rock void fraction open to flow (0 to 1)</td><td style="text-align: right">-</td><td style="text-align: right">0.3</td></tr><tr><td style="text-align: right"><code>rock_density</code></td><td style="text-align: right">Mass density of rock</td><td style="text-align: right"><span>$kg^3/m^3$</span></td><td style="text-align: right">2000.0</td></tr><tr><td style="text-align: right"><code>rock_heat_capacity</code></td><td style="text-align: right">Specific heat capacity of rock</td><td style="text-align: right"><span>$J/(kg K)$</span></td><td style="text-align: right">900.0</td></tr><tr><td style="text-align: right"><code>rock_thermal_conductivity</code></td><td style="text-align: right">Heat conductivity of rock</td><td style="text-align: right"><span>$W/m K$</span></td><td style="text-align: right">3.0</td></tr><tr><td style="text-align: right"><code>fluid_thermal_conductivity</code></td><td style="text-align: right">Heat conductivity of fluid phases</td><td style="text-align: right"><span>$W/m K$</span></td><td style="text-align: right">0.6</td></tr><tr><td style="text-align: right"><code>component_heat_capacity</code></td><td style="text-align: right">Specific heat capacity of fluid components</td><td style="text-align: right"><span>$J/(kg K)$</span></td><td style="text-align: right">4184.0</td></tr></table><p>Note that the default values are taken to be roughly those of water for fluid phases and sandstone for those of rock. Choice of values can severely impact your simulation results - take care to check the values that your physical system makes use of!</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/faf16d922c9d668af314fe1673cfb5dbfbd153b0/src/utils.jl#L31-L57">source</a></section><section><div><pre><code class="language-julia hljs">reservoir_domain(m::Union{SimulationModel, MultiModel})</code></pre><p>Get reservoir domain embedded in model.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/faf16d922c9d668af314fe1673cfb5dbfbd153b0/src/utils.jl#L106-L110">source</a></section><section><div><pre><code class="language-julia hljs">reservoir_domain(case::JutulCase)</code></pre><p>Get reservoir domain from a reservoir simulation case.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/faf16d922c9d668af314fe1673cfb5dbfbd153b0/src/utils.jl#L116-L120">source</a></section></article><h3 id="Wells"><a class="docs-heading-anchor" href="#Wells">Wells</a><a id="Wells-1"></a><a class="docs-heading-anchor-permalink" href="#Wells" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JutulDarcy.setup_well" href="#JutulDarcy.setup_well"><code>JutulDarcy.setup_well</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">setup_well(D::DataDomain, reservoir_cells; skin = 0.0, Kh = nothing, radius = 0.1, dir = :z, name = :Well)
w = setup_well(D, 1, name = :MyWell)         # Cell 1 in the grid
w = setup_well(D, (2, 5, 1), name = :MyWell) # Position (2, 5, 1) in logically structured mesh
w2 = setup_well(D, [1, 2, 3], name = :MyOtherWell)</code></pre><p>Set up a well in <code>reservoir_cells</code> with given skin factor and radius. The order of cells matter as it is treated as a trajectory.</p><p>The <code>name</code> keyword argument can be left defaulted if your model will only have a single well (named <code>:Well</code>). It is highly recommended to provide this whenever a well is set up.</p><p><code>reservoir_cells</code> can be one of the following: A Vector of cells, a single cell, a Vector of <code>(I, J, K)</code> Tuples or a single Tuple of the same type.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/faf16d922c9d668af314fe1673cfb5dbfbd153b0/src/facility/wells/wells.jl#L65-L81">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JutulDarcy.setup_vertical_well" href="#JutulDarcy.setup_vertical_well"><code>JutulDarcy.setup_vertical_well</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">setup_vertical_well(D::DataDomain, i, j; name = :MyWell, &lt;kwarg&gt;)</code></pre><p>Set up a vertical well with a <a href="../../ref/jutul/#Jutul.DataDomain-Tuple{JutulDomain}"><code>DataDomain</code></a> input that represents the porous medium / reservoir where the wells it to be placed. See <a href="../basics/wells/#JutulDarcy.SimpleWell"><code>SimpleWell</code></a>, <a href="../basics/wells/#JutulDarcy.MultiSegmentWell"><code>MultiSegmentWell</code></a> and <a href="#JutulDarcy.setup_well"><code>setup_well</code></a> for more details about possible keyword arguments.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/faf16d922c9d668af314fe1673cfb5dbfbd153b0/src/facility/wells/wells.jl#L218-L225">source</a></section><section><div><pre><code class="language-julia hljs">setup_vertical_well(g, K, i, j; heel = 1, toe = grid_dims_ijk(g)[3], kwarg...)</code></pre><p>Set up a vertical well for given grid <code>g</code> and permeability <code>K</code> at logical indices <code>i, j</code> perforating all cells starting at k-logical index <code>heel</code> to <code>toe</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/faf16d922c9d668af314fe1673cfb5dbfbd153b0/src/facility/wells/wells.jl#L232-L238">source</a></section></article><h3 id="Model"><a class="docs-heading-anchor" href="#Model">Model</a><a id="Model-1"></a><a class="docs-heading-anchor-permalink" href="#Model" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JutulDarcy.setup_reservoir_model" href="#JutulDarcy.setup_reservoir_model"><code>JutulDarcy.setup_reservoir_model</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">model, parameters = setup_reservoir_model(reservoir, system; wells = [], &lt;keyword arguments&gt;)
model, parameters = setup_reservoir_model(reservoir, system; wells = [w1, w2], backend = :csr, &lt;keyword arguments&gt;)</code></pre><p>Set up a reservoir <code>MultiModel</code> for a given reservoir <code>DataDomain</code> typically set up from  <a href="#JutulDarcy.reservoir_domain"><code>reservoir_domain</code></a> and an optional vector of wells that are created using <a href="#JutulDarcy.setup_vertical_well"><code>setup_vertical_well</code></a> and  <a href="#JutulDarcy.setup_well"><code>setup_well</code></a>.</p><p>The routine automatically sets up a facility and couples the wells with the reservoir and that facility.</p><p><strong>Keyword arguments</strong></p><ul><li><code>wells=[]</code>: Vector of wells (e.g. from <a href="#JutulDarcy.setup_well"><code>setup_well</code></a>) that are to be used in the model. Each well must have a unique name.</li><li><code>extra_out=true</code>: Return both the model and the parameters instead of just the model.</li><li><code>kgrad=nothing</code>: Type of spatial discretization to use:<ul><li><code>:tpfa</code> or <code>nothing</code> gives standard two-point flux approximation (TPFA) with hard-coded two-point assembly</li><li><code>:tpfa_test</code> gives TPFA with specialized finite-volume assembly. Should be similar in performance to <code>:tpfa</code>, but does not make use of threads.</li><li><code>:avgmpfa</code> gives a consistent linear MPFA scheme that is more accurate for meshes with anisotropic perm or non-orthogonal cells than <code>:tpfa</code>.</li><li><code>:ntpfa</code> gives a consistent nonlinear MPFA scheme (nonlinear version of <code>:avgmpfa</code> that preserves monotonicity)</li></ul></li><li><code>extra_outputs=Symbol[]</code>: Extra output variables for reservoir model. Defaults to &quot;typical&quot; values seen in reservoir simulation. Valid values: Vector of symbols to be output, <code>true</code> for all variables and <code>false</code> for the minimal set required to restart simulations (typically only the primary variables and mass of each component)</li></ul><p><strong>Advanced model setup</strong></p><p>Advanced options govern internals of the simulator, like type of automatic differentation, how equations are linearized and so on. These should not impact simulation results beyond what is allowed for the model tolerances, but can impact simulation speed.</p><ul><li><code>split_wells=false</code>: Add a facility model for each well instead of one facility model that controls all wells. This must be set to <code>true</code> if you want to use MPI or nonlinear domain decomposition.</li><li><code>backend=:csc</code>: Backend to use. Can be <code>:csc</code> for serial compressed sparse column CSC matrix, <code>:csr</code> for parallel compressed sparse row matrix. <code>:csr</code> is a bit faster and is recommended when using MPI, HYPRE or multiple threads. <code>:csc</code> uses the default Julia format and is interoperable with other Julia libraries.</li><li><code>context=DefaultContext()</code>: Context used for entire model. Not recommended to set up manually, use <code>backend</code> instead.</li><li><code>assemble_wells_together=true</code>: Assemble wells in a single big matrix rather than many small matrices.</li><li><code>block_backend=true</code>: Use block sparse representation. This is needed by the iterative solvers and corresponding preconditioners. Setting this to <code>false</code> will result in a direct solver being used. In addition, equations will be assembled in an order similar to that of MRST (equation major instead of cell major).</li><li><code>general_ad=false</code>: Use more general form of AD. Will result in slower execution speed than if set to true, but can be useful when working with custom discretizations.</li></ul><p><strong>Increment and variable options</strong></p><p>These options govern the range of values and the maximum allowable change of properties over a single Newton iteration. Changing values for maximum change will not change the equations themselves, but the values will change the rate of nonlinear solver convergence. Typically, smaller values are more conservative and reduce numerical difficulties, but can significantly increase the number of iterations and the reduce the length of the average time-step. Setting very small values can make it infeasible to solve the problems in a reasonable time.</p><p>Note that relative values are usually given relative to the cell value. If your expected output values are close to zero (e.g. for near-atmospheric pressure) low values can lead to slow convergence.</p><ul><li><code>dp_max_abs=nothing</code>: Maximum allowable pressure change in SI units (Pa)</li><li><code>dp_max_rel=0.2</code>: Maximum allowable relative pressure change (default is 20%)</li><li><code>dp_max_abs_well=convert_to_si(50, :bar)</code>: Maximum allowable pressure change for wells in SI units (Pa)</li><li><code>dp_max_rel_well=nothing</code>: Maximum allowable relative pressure change in well</li><li><code>ds_max=0.2</code>: Maximum change in saturations</li><li><code>dz_max=0.2</code>: Maximum change in composition (for compositional models only)</li><li><code>p_min=JutulDarcy.DEFAULT_MINIMUM_PRESSURE</code>: Minimum pressure in model (hard limit)</li><li><code>p_max=Inf</code>: Maximum pressure in model (hard limit)</li><li><code>dr_max=Inf</code>: Maximum change in Rs/Rv for blackoil models over a Newton iteration. Taken relative to the saturated value of the cell.</li><li><code>dT_max_rel=nothing</code>: Maximum relative change in temperature (JutulDarcy uses Kelvin, so comments about changing limits near zero above does not apply to typical reservoir temperatures)</li><li><code>dT_max_abs=50.0</code>: Maximum absolute change in temperature (in °K/°C)</li><li><code>fast_flash=false</code>: Shorthand to enable <code>flash_reuse_guess</code> and <code>flash_stability_bypass</code>. These options can together speed up the time spent in flash solver for compositional models. Options are based on &quot;Increasing the Computational Speed of Flash Calculations With Applications for Compositional, Transient Simulations&quot; by Rasmussen et al (2006).</li><li><code>flash_reuse_guess=fast_flash</code>: Reuse previous flash guess when a cell remains in two-phase.</li><li><code>flash_stability_bypass=fast_flash</code>: Bypass stability testing for cells outside the two-phase and shadow region.</li><li><code>can_shut_wells=true</code>: Configure facility to allow shutting wells that repeatedly get rates with the wrong side. Disabling this can make certain models infeasible to simulate, but it can be useful to do so for simple models where you know that the wells should be operational.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/faf16d922c9d668af314fe1673cfb5dbfbd153b0/src/utils.jl#L177-L278">source</a></section></article><h3 id="Initial-state"><a class="docs-heading-anchor" href="#Initial-state">Initial state</a><a id="Initial-state-1"></a><a class="docs-heading-anchor-permalink" href="#Initial-state" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JutulDarcy.setup_reservoir_state" href="#JutulDarcy.setup_reservoir_state"><code>JutulDarcy.setup_reservoir_state</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">setup_reservoir_state(model, &lt;keyword arguments&gt;)
# Ex: For immiscible two-phase
setup_reservoir_state(model, Pressure = 1e5, Saturations = [0.2, 0.8])</code></pre><p>Convenience constructor that initializes a state for a <code>MultiModel</code> set up using <a href="#JutulDarcy.setup_reservoir_model"><code>setup_reservoir_model</code></a>. The main convenience over <a href="../../ref/jutul/#Jutul.setup_state-Tuple{JutulModel, Vararg{Any}}"><code>setup_state</code></a> is only the reservoir initialization values need be provided: wells are automatically initialized from the connected reservoir cells.</p><p>As an alternative to passing keyword arguments, a <code>Dict{Symbol, Any}</code> instance can be sent in as a second, non-keyword argument.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/faf16d922c9d668af314fe1673cfb5dbfbd153b0/src/utils.jl#L996-L1008">source</a></section></article><p>TODO: Write about hydrostatic equilbriation.</p><h2 id="Simulation"><a class="docs-heading-anchor" href="#Simulation">Simulation</a><a id="Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Simulation" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JutulDarcy.simulate_reservoir" href="#JutulDarcy.simulate_reservoir"><code>JutulDarcy.simulate_reservoir</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">simulate_reservoir(state0, model, dt;
    parameters = setup_parameters(model),
    restart = false,
    forces = setup_forces(model),
    kwarg...
)
simulate_reservoir(case;
    kwarg...
)</code></pre><p>Convenience function for simulating a reservoir model. This function internally calls <a href="#JutulDarcy.setup_reservoir_simulator"><code>setup_reservoir_simulator</code></a>, simulates the problem and returns a <a href="#JutulDarcy.ReservoirSimResult"><code>ReservoirSimResult</code></a>. Keyword arguments are passed onto <a href="#JutulDarcy.setup_reservoir_simulator"><code>setup_reservoir_simulator</code></a> and are documented in that function.</p><p>You can optionally unpack this result into the most typical desired outputs:</p><p><code>wellsols, states = simulate_reservoir(...)</code></p><p>where <code>wellsols</code> contains the well results and <code>states</code> the reservoir results (pressure, saturations and so on, in each cell of the reservoir domain).</p><p><strong>Examples</strong></p><p>You can restart/resume simulations by both providing the <code>output_path</code> argument and the <code>restart</code> argument:</p><pre><code class="nohighlight hljs"># Automatically restart from last solved step and returning the outputs if the simulation was already solved.
result = simulate_reservoir(state0, model, dt, output_path = &quot;/some/path&quot;, restart = true)

# Restart from step 5
result = simulate_reservoir(state0, model, dt, output_path = &quot;/some/path&quot;, restart = 5)

# Start from the beginning (default)
result = simulate_reservoir(state0, model, dt, output_path = &quot;/some/path&quot;, restart = false)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/faf16d922c9d668af314fe1673cfb5dbfbd153b0/src/utils.jl#L745-L782">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JutulDarcy.setup_reservoir_simulator" href="#JutulDarcy.setup_reservoir_simulator"><code>JutulDarcy.setup_reservoir_simulator</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">setup_reservoir_simulator(models, initializer, parameters = nothing; &lt;keyword arguments&gt;)</code></pre><p><strong>Arguments</strong></p><ul><li><code>models</code>: either a single model or a Dict with the key :Reservoir for multimodels</li><li><code>initializer</code>: used to setup state0, must be compatible with <code>model</code></li><li><code>parameters</code>: initialized parameters, must be compatible with <code>model</code> if provided</li></ul><p><strong>Keyword arguments</strong></p><ul><li><code>split_wells</code>: Add facility model to each well (needed for domain decomposition and MPI solves)</li><li><code>assemble_wells_together</code>: Option to split wells into multiple sparse matrices (false argument experimental)</li><li><code>specialize=false</code>: use deep specialization of storage for faster execution, but significantly more compile time</li></ul><p>Additional keyword arguments are documented in the version of this function that uses <code>JutulCase</code> as the input.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/faf16d922c9d668af314fe1673cfb5dbfbd153b0/src/utils.jl#L472-L486">source</a></section><section><div><pre><code class="language-julia hljs">setup_reservoir_simulator(case::JutulCase; &lt;keyword arguments&gt;)</code></pre><p><strong>Keyword arguments</strong></p><ul><li><code>mode=:default</code>: Mode used for solving. Can be set to <code>:mpi</code> if running in MPI mode together with HYPRE, PartitionedArrays and MPI in your environment.</li><li><code>method=:newton</code>: Can be <code>:newton</code>, <code>:nldd</code> or <code>:aspen</code>. Newton is the most tested approach and <code>:nldd</code> can speed up difficult models. The <code>:nldd</code> option enables a host of additional options (look at the simulator config for more details).</li><li><code>presolve_wells=false</code>: Solve wells before each linearization. Can improve convergence for models with multisegment wells.</li></ul><p><strong>Linear solver options</strong></p><ul><li><code>linear_solver=:bicgstab</code>: iterative solver to use (provided model supports it). Typical options are <code>:bicgstab</code> or <code>:gmres</code> Can alternatively pass a linear solver instance.</li><li><code>precond=:cpr</code>: preconditioner for iterative solver: Either :cpr or :ilu0.</li><li><code>rtol=1e-3</code>: relative tolerance for linear solver</li><li><code>linear_solver_arg</code>: <code>Dict</code> containing additional linear solver arguments.</li></ul><p><strong>Timestepping options</strong></p><ul><li><code>initial_dt=si_unit(:day)</code>: initial timestep in seconds (one day by default)</li><li><code>target_ds=Inf</code>: target saturation change over a timestep used by timestepper.</li><li><code>target_its=8</code>: target number of nonlinear iterations per time step</li><li><code>offset_its=1</code>: dampening parameter for time step selector where larger values lead to more pessimistic estimates.</li><li><code>timesteps=:auto</code>: Set to <code>:auto</code> to use automatic timestepping, <code>:none</code> for no automatic timestepping (i.e. try to solve exact report steps)</li><li><code>max_timestep=si_unit(:year)</code>: Maximum internal timestep used in solver.</li></ul><p><strong>Convergence criterions</strong></p><ul><li><code>tol_cnv=1e-3</code>: maximum allowable point-wise error (volume-balance)</li><li><code>tol_mb=1e-7</code>: maximum alllowable integrated error (mass-balance)</li><li><code>tol_cnv_well=10*tol_cnv</code>: maximum allowable point-wise error for well node (volume-balance)</li><li><code>tol_mb_well=1e4*tol_mb</code>: maximum alllowable integrated error for well node (mass-balance)</li><li><code>inc_tol_dp_abs=Inf</code>: Maximum allowable pressure change (absolute)</li><li><code>inc_tol_dp_rel=Inf</code>: Maximum allowable pressure change (absolute)</li><li><code>inc_tol_dz=Inf</code>: Maximum allowable composition change (compositional only).</li></ul><p><strong>Inherited keyword arguments</strong></p><p>Additional keyword arguments come from the base Jutul simulation framework. We list a few of the most relevant entries here for convenience:</p><ul><li><code>info_level = 0</code>: Output level. Set to 0 for minimal output, -1 for no output and 1 or more for increasing verbosity.</li><li><code>output_path</code>: Path to write output to.</li><li><code>max_nonlinear_iterations=15</code>: Maximum Newton iterations before a time-step is cut.</li><li><code>min_nonlinear_iterations=1</code>: Minimum number of Newtons to perform before checking convergence.</li><li><code>relaxation=Jutul.NoRelaxation()</code>: Dampening used for solves. Can be set to <code>Jutul.SimpleRelaxation()</code> for difficult models. Equivialent option is to set <code>true</code> for relaxation and <code>false</code> for no relaxation.</li><li><code>failure_cuts_timestep=true</code>: Cut timestep instead of throwing an error when numerical issues are encountered (e.g. linear solver divergence).</li><li><code>max_timestep_cuts=25</code>: Maximum number of timestep cuts before a solver gives up. Note that when using dynamic timestepping, this in practice defines a minimal timestep, with more than the prescribed number of cuts being allowed if the timestep is dynamically increased after cutting.</li><li><code>timestep_max_increase=10.0</code>: Max allowable factor to increase time-step by. Overrides any choices made in dynamic step selection.</li><li><code>timestep_max_decrease=0.1</code>: Max allowable factor to decrease time-step by. Overrides any choices made in dynamic step selection.</li><li><code>tol_factor_final_iteration=1.0</code>: If set to a value larger than 1.0, the final convergence check before a time-step is cut is relaxed by multiplying all tolerances with this value. Warning: Setting it to a large value can have severe impact on numerical accuracy. A value of 1 to 10 is typically safe if your default tolerances are strict.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/faf16d922c9d668af314fe1673cfb5dbfbd153b0/src/utils.jl#L528-L603">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JutulDarcy.ReservoirSimResult" href="#JutulDarcy.ReservoirSimResult"><code>JutulDarcy.ReservoirSimResult</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ReservoirSimResult(model, result::Jutul.SimResult, forces, extra = Dict(); kwarg...)</code></pre><p>Create a specific reservoir simulation results that contains well curves, reservoir states, and so on. This is the return type from <code>simulate_reservoir</code>.</p><p>A <code>ReservoirSimResult</code> can be unpacked into well solutions, reservoir states and reporting times:</p><pre><code class="language-julia hljs">res_result::ReservoirSimResult
ws, states, t = res_result</code></pre><p><strong>Fields</strong></p><ul><li><p><code>wells</code></p></li><li><p><code>states</code></p></li><li><p><code>time</code></p></li><li><p><code>result</code></p></li><li><p><code>extra</code></p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/faf16d922c9d668af314fe1673cfb5dbfbd153b0/src/types.jl#L577-L594">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../examples/validation_mrst/">« Validation: MRST input files</a><a class="docs-footer-nextpage" href="../basics/input_files/">Input formats »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Monday 23 September 2024 13:24">Monday 23 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
