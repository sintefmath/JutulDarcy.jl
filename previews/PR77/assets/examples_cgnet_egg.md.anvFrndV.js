import{_ as i,c as a,a5 as n,o as p}from"./chunks/framework.CL-q2w8x.js";const l="/JutulDarcy.jl/previews/PR77/assets/mfwptcn.BpB_R1AB.jpeg",t="/JutulDarcy.jl/previews/PR77/assets/genreut.23WQ9MyI.jpeg",e="/JutulDarcy.jl/previews/PR77/assets/zxjabfx.DUb1QxfW.jpeg",h="/JutulDarcy.jl/previews/PR77/assets/imlkywr.BAsGr05P.jpeg",k="/JutulDarcy.jl/previews/PR77/assets/xulhiux.Ddn8jn71.jpeg",r="/JutulDarcy.jl/previews/PR77/assets/nrzxogi.CUn4lXfZ.jpeg",E="/JutulDarcy.jl/previews/PR77/assets/tbfauwq.CsPV9srE.jpeg",d="/JutulDarcy.jl/previews/PR77/assets/umlhrmp.JPULt4hu.jpeg",g="/JutulDarcy.jl/previews/PR77/assets/sxymofl.0QX2j6F-.jpeg",c="/JutulDarcy.jl/previews/PR77/assets/bxkjyrn.Dlh9dRvs.jpeg",o="/JutulDarcy.jl/previews/PR77/assets/ytgytqo.B6WQgPq_.jpeg",y="/JutulDarcy.jl/previews/PR77/assets/tsjcnph.DN-HDRgW.jpeg",u="/JutulDarcy.jl/previews/PR77/assets/gwcdret.BqMmA7ki.jpeg",B=JSON.parse('{"title":"History matching a coarse model - CGNet","description":"","frontmatter":{},"headers":[],"relativePath":"examples/cgnet_egg.md","filePath":"examples/cgnet_egg.md","lastUpdated":null}'),F={name:"examples/cgnet_egg.md"};function m(b,s,C,D,A,f){return p(),a("div",null,s[0]||(s[0]=[n(`<h1 id="History-matching-a-coarse-model-CGNet" tabindex="-1">History matching a coarse model - CGNet <a class="header-anchor" href="#History-matching-a-coarse-model-CGNet" aria-label="Permalink to &quot;History matching a coarse model - CGNet {#History-matching-a-coarse-model-CGNet}&quot;">​</a></h1><p>This example demonstrates how to calibrate a coarse model against results from a fine model. We do this by optimizing the parameters of the coarse model to match the well curves. This is a implementation of the method described in [<a href="/JutulDarcy.jl/previews/PR77/extras/refs#cgnet1">7</a>]. This also serves as a demonstration of how to use the simulator for history matching, as the fine model results can stand in for real field observations.</p><h2 id="Load-and-simulate-Egg-base-case" tabindex="-1">Load and simulate Egg base case <a class="header-anchor" href="#Load-and-simulate-Egg-base-case" aria-label="Permalink to &quot;Load and simulate Egg base case {#Load-and-simulate-Egg-base-case}&quot;">​</a></h2><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Jutul, JutulDarcy, HYPRE, GeoEnergyIO, GLMakie</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LBFGSB </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lb</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">egg_dir </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JutulDarcy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GeoEnergyIO</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">test_input_file_path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;EGG&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data_pth </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> joinpath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(egg_dir, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;EGG.DATA&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fine_case </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> setup_case_from_data_file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data_pth)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">simulated_fine </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> simulate_reservoir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fine_case)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">plot_reservoir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fine_case, simulated_fine</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">states, key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :Saturations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, step </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><img src="`+l+`" alt=""></p><h2 id="Create-initial-coarse-model-and-simulate" tabindex="-1">Create initial coarse model and simulate <a class="header-anchor" href="#Create-initial-coarse-model-and-simulate" aria-label="Permalink to &quot;Create initial coarse model and simulate {#Create-initial-coarse-model-and-simulate}&quot;">​</a></h2><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">coarse_case </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JutulDarcy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">coarsen_reservoir_case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fine_case, (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">25</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">25</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), method </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :ijk</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">simulated_coarse </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> simulate_reservoir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(coarse_case, info_level </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">plot_reservoir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(coarse_case, simulated_coarse</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">states, key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :Saturations</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, step </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><img src="`+t+`" alt=""></p><h2 id="Setup-optimization" tabindex="-1">Setup optimization <a class="header-anchor" href="#Setup-optimization" aria-label="Permalink to &quot;Setup optimization {#Setup-optimization}&quot;">​</a></h2><p>We set up the optimization problem by defining the objective function as a sum of squared mismatches for all well observations, for all time-steps. We also define limits for the parameters, and set up the optimization problem.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setup_optimization_cgnet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(case_c, case_f, result_f)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    states_f </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result_f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">states</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    wells_results, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result_f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model_c </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> case_c</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">model</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    state0_c </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> setup_state</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(model_c, case_c</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">state0);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    param_c </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> setup_parameters</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(model_c)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    forces_c </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> case_c</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">forces</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    dt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> case_c</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dt</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    model_f </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> case_f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">model</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    bhp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JutulDarcy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BottomHolePressureTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    wells </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> collect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">keys</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(JutulDarcy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">get_model_wells</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(case_f)))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    day </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> si_unit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:day</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    wrat_scale </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">150</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">day</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    orat_scale </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">day</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    grat_scale </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">day</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    w </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    matches </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    signs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> []</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sys </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> reservoir_model</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(model_f)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">system</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    wrat </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SurfaceWaterRateTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    orat </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SurfaceOilRateTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    grat </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SurfaceGasRateTarget</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(matches, bhp)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(w, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">si_unit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:bar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(signs, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> phase </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JutulDarcy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">get_phases</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sys)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> phase </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> LiquidPhase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(matches, orat)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(w, orat_scale)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(signs, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        elseif</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> phase </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> VaporPhase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(matches, grat)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(w, grat_scale)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(signs, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        else</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            @assert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> phase </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> AqueousPhase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(matches, wrat)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(w, wrat_scale)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            push!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(signs, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    signs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> zeros</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Int, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(signs))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    o_scale </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(dt)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(wells))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    G </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (model_c, state_c, dt, step_no, forces) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> well_mismatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        matches,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        wells,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        model_f,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        states_f,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        model_c,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        state_c,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        dt,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        step_no,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        forces,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        weights </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> w,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        scale </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> o_scale,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        signs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> signs</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    @assert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Jutul</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">evaluate_objective</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(G, model_f, states_f, dt, case_f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">forces) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    cfg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> optimization_config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(model_c, param_c,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        use_scaling </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        rel_min </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        rel_max </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (k, v) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> cfg</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (ki, vi) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ki </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :FluidVolume</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                vi[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:active</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> k </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :Reservoir</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ki </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :ConnateWater</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                vi[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:active</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ki </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:TwoPointGravityDifference</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:PhaseViscosities</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:PerforationGravityDifference</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                vi[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:active</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ki </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:WellIndices</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:Transmissibilities</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                vi[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:active</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                vi[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:abs_min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                vi[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:abs_max</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1e-6</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        end</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    opt_setup </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> setup_parameter_optimization</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(model_c, state0_c, param_c, dt, forces_c, G, cfg);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    x0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> opt_setup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    F0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> opt_setup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">F!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x0)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    dF0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> opt_setup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">dF!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">similar</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x0), x0)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Initial objective: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$F0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">, gradient norm </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$(sum(abs, dF0))</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> opt_setup</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>setup_optimization_cgnet (generic function with 1 method)</span></span></code></pre></div><h2 id="Define-the-optimization-loop" tabindex="-1">Define the optimization loop <a class="header-anchor" href="#Define-the-optimization-loop" aria-label="Permalink to &quot;Define the optimization loop {#Define-the-optimization-loop}&quot;">​</a></h2><p>JutulDarcy can use any optimization package that can work with gradients and limits, here we use the <code>LBFGSB</code> package.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> optimize_cgnet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(opt_setup)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    lower </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> opt_setup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">limits</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">min</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    upper </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> opt_setup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">limits</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">max</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    x0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> opt_setup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    n </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x0)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    setup </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Dict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:lower</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lower, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:upper</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> upper, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:x0</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> copy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(x0))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    prt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    f! </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (x) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> opt_setup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">F_and_dF!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NaN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, x)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    g! </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (dFdx, x) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> opt_setup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">F_and_dF!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">NaN</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, dFdx, x)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    results, final_x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">lbfgsb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(f!, g!, x0, lb</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">lower, ub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">upper,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        iprint </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> prt,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        factr </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1e12</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        maxfun </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        maxiter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        m </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (final_x, results, setup)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>optimize_cgnet (generic function with 1 method)</span></span></code></pre></div><h2 id="Run-the-optimization" tabindex="-1">Run the optimization <a class="header-anchor" href="#Run-the-optimization" aria-label="Permalink to &quot;Run the optimization {#Run-the-optimization}&quot;">​</a></h2><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">opt_setup </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> setup_optimization_cgnet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(coarse_case, fine_case, simulated_fine);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">final_x, results, setup </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> optimize_cgnet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(opt_setup);</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Parameters for PROD4</span></span>
<span class="line"><span>┌─────────────┬──────────────┬───┬─────────┬─────────────┬────────────────┬──────────────────────┬─────────┐</span></span>
<span class="line"><span>│        Name │       Entity │ N │   Scale │ Abs. limits │    Rel. limits │               Limits │ Lumping │</span></span>
<span class="line"><span>├─────────────┼──────────────┼───┼─────────┼─────────────┼────────────────┼──────────────────────┼─────────┤</span></span>
<span class="line"><span>│ WellIndices │ Perforations │ 5 │ default │  [0, 1e-06] │ [0.001, 1e+03] │ [4.22e-15, 7.95e-09] │       - │</span></span>
<span class="line"><span>└─────────────┴──────────────┴───┴─────────┴─────────────┴────────────────┴──────────────────────┴─────────┘</span></span>
<span class="line"><span>Parameters for Reservoir</span></span>
<span class="line"><span>┌────────────────────┬────────┬──────┬─────────┬─────────────────┬────────────────┬──────────────────────┬─────────┐</span></span>
<span class="line"><span>│               Name │ Entity │    N │   Scale │     Abs. limits │    Rel. limits │               Limits │ Lumping │</span></span>
<span class="line"><span>├────────────────────┼────────┼──────┼─────────┼─────────────────┼────────────────┼──────────────────────┼─────────┤</span></span>
<span class="line"><span>│ Transmissibilities │  Faces │ 6792 │ default │      [0, 1e-06] │ [0.001, 1e+03] │ [1.71e-16, 4.75e-08] │       - │</span></span>
<span class="line"><span>│        FluidVolume │  Cells │ 2516 │ default │ [2.22e-16, Inf] │ [0.001, 1e+03] │   [0.0512, 9.22e+05] │       - │</span></span>
<span class="line"><span>└────────────────────┴────────┴──────┴─────────┴─────────────────┴────────────────┴──────────────────────┴─────────┘</span></span>
<span class="line"><span>Parameters for INJECT5</span></span>
<span class="line"><span>┌─────────────┬──────────────┬───┬─────────┬─────────────┬────────────────┬──────────────────────┬─────────┐</span></span>
<span class="line"><span>│        Name │       Entity │ N │   Scale │ Abs. limits │    Rel. limits │               Limits │ Lumping │</span></span>
<span class="line"><span>├─────────────┼──────────────┼───┼─────────┼─────────────┼────────────────┼──────────────────────┼─────────┤</span></span>
<span class="line"><span>│ WellIndices │ Perforations │ 5 │ default │  [0, 1e-06] │ [0.001, 1e+03] │ [9.46e-15, 1.96e-08] │       - │</span></span>
<span class="line"><span>└─────────────┴──────────────┴───┴─────────┴─────────────┴────────────────┴──────────────────────┴─────────┘</span></span>
<span class="line"><span>Parameters for INJECT4</span></span>
<span class="line"><span>┌─────────────┬──────────────┬───┬─────────┬─────────────┬────────────────┬──────────────────────┬─────────┐</span></span>
<span class="line"><span>│        Name │       Entity │ N │   Scale │ Abs. limits │    Rel. limits │               Limits │ Lumping │</span></span>
<span class="line"><span>├─────────────┼──────────────┼───┼─────────┼─────────────┼────────────────┼──────────────────────┼─────────┤</span></span>
<span class="line"><span>│ WellIndices │ Perforations │ 5 │ default │  [0, 1e-06] │ [0.001, 1e+03] │ [2.33e-15, 5.35e-09] │       - │</span></span>
<span class="line"><span>└─────────────┴──────────────┴───┴─────────┴─────────────┴────────────────┴──────────────────────┴─────────┘</span></span>
<span class="line"><span>Parameters for INJECT8</span></span>
<span class="line"><span>┌─────────────┬──────────────┬───┬─────────┬─────────────┬────────────────┬─────────────────────┬─────────┐</span></span>
<span class="line"><span>│        Name │       Entity │ N │   Scale │ Abs. limits │    Rel. limits │              Limits │ Lumping │</span></span>
<span class="line"><span>├─────────────┼──────────────┼───┼─────────┼─────────────┼────────────────┼─────────────────────┼─────────┤</span></span>
<span class="line"><span>│ WellIndices │ Perforations │ 5 │ default │  [0, 1e-06] │ [0.001, 1e+03] │ [2.9e-15, 7.68e-09] │       - │</span></span>
<span class="line"><span>└─────────────┴──────────────┴───┴─────────┴─────────────┴────────────────┴─────────────────────┴─────────┘</span></span>
<span class="line"><span>Parameters for INJECT6</span></span>
<span class="line"><span>┌─────────────┬──────────────┬───┬─────────┬─────────────┬────────────────┬──────────────────────┬─────────┐</span></span>
<span class="line"><span>│        Name │       Entity │ N │   Scale │ Abs. limits │    Rel. limits │               Limits │ Lumping │</span></span>
<span class="line"><span>├─────────────┼──────────────┼───┼─────────┼─────────────┼────────────────┼──────────────────────┼─────────┤</span></span>
<span class="line"><span>│ WellIndices │ Perforations │ 5 │ default │  [0, 1e-06] │ [0.001, 1e+03] │ [5.94e-15, 1.29e-08] │       - │</span></span>
<span class="line"><span>└─────────────┴──────────────┴───┴─────────┴─────────────┴────────────────┴──────────────────────┴─────────┘</span></span>
<span class="line"><span>Parameters for INJECT1</span></span>
<span class="line"><span>┌─────────────┬──────────────┬───┬─────────┬─────────────┬────────────────┬──────────────────────┬─────────┐</span></span>
<span class="line"><span>│        Name │       Entity │ N │   Scale │ Abs. limits │    Rel. limits │               Limits │ Lumping │</span></span>
<span class="line"><span>├─────────────┼──────────────┼───┼─────────┼─────────────┼────────────────┼──────────────────────┼─────────┤</span></span>
<span class="line"><span>│ WellIndices │ Perforations │ 5 │ default │  [0, 1e-06] │ [0.001, 1e+03] │ [4.45e-15, 1.02e-08] │       - │</span></span>
<span class="line"><span>└─────────────┴──────────────┴───┴─────────┴─────────────┴────────────────┴──────────────────────┴─────────┘</span></span>
<span class="line"><span>Parameters for INJECT7</span></span>
<span class="line"><span>┌─────────────┬──────────────┬───┬─────────┬─────────────┬────────────────┬──────────────────────┬─────────┐</span></span>
<span class="line"><span>│        Name │       Entity │ N │   Scale │ Abs. limits │    Rel. limits │               Limits │ Lumping │</span></span>
<span class="line"><span>├─────────────┼──────────────┼───┼─────────┼─────────────┼────────────────┼──────────────────────┼─────────┤</span></span>
<span class="line"><span>│ WellIndices │ Perforations │ 5 │ default │  [0, 1e-06] │ [0.001, 1e+03] │ [2.23e-15, 4.66e-09] │       - │</span></span>
<span class="line"><span>└─────────────┴──────────────┴───┴─────────┴─────────────┴────────────────┴──────────────────────┴─────────┘</span></span>
<span class="line"><span>Parameters for INJECT3</span></span>
<span class="line"><span>┌─────────────┬──────────────┬───┬─────────┬─────────────┬────────────────┬─────────────────────┬─────────┐</span></span>
<span class="line"><span>│        Name │       Entity │ N │   Scale │ Abs. limits │    Rel. limits │              Limits │ Lumping │</span></span>
<span class="line"><span>├─────────────┼──────────────┼───┼─────────┼─────────────┼────────────────┼─────────────────────┼─────────┤</span></span>
<span class="line"><span>│ WellIndices │ Perforations │ 5 │ default │  [0, 1e-06] │ [0.001, 1e+03] │ [4.87e-15, 1.3e-08] │       - │</span></span>
<span class="line"><span>└─────────────┴──────────────┴───┴─────────┴─────────────┴────────────────┴─────────────────────┴─────────┘</span></span>
<span class="line"><span>Parameters for PROD2</span></span>
<span class="line"><span>┌─────────────┬──────────────┬───┬─────────┬─────────────┬────────────────┬──────────────────────┬─────────┐</span></span>
<span class="line"><span>│        Name │       Entity │ N │   Scale │ Abs. limits │    Rel. limits │               Limits │ Lumping │</span></span>
<span class="line"><span>├─────────────┼──────────────┼───┼─────────┼─────────────┼────────────────┼──────────────────────┼─────────┤</span></span>
<span class="line"><span>│ WellIndices │ Perforations │ 5 │ default │  [0, 1e-06] │ [0.001, 1e+03] │ [2.96e-14, 4.31e-08] │       - │</span></span>
<span class="line"><span>└─────────────┴──────────────┴───┴─────────┴─────────────┴────────────────┴──────────────────────┴─────────┘</span></span>
<span class="line"><span>Parameters for PROD3</span></span>
<span class="line"><span>┌─────────────┬──────────────┬───┬─────────┬─────────────┬────────────────┬─────────────────────┬─────────┐</span></span>
<span class="line"><span>│        Name │       Entity │ N │   Scale │ Abs. limits │    Rel. limits │              Limits │ Lumping │</span></span>
<span class="line"><span>├─────────────┼──────────────┼───┼─────────┼─────────────┼────────────────┼─────────────────────┼─────────┤</span></span>
<span class="line"><span>│ WellIndices │ Perforations │ 5 │ default │  [0, 1e-06] │ [0.001, 1e+03] │ [2.34e-15, 5.7e-09] │       - │</span></span>
<span class="line"><span>└─────────────┴──────────────┴───┴─────────┴─────────────┴────────────────┴─────────────────────┴─────────┘</span></span>
<span class="line"><span>Parameters for PROD1</span></span>
<span class="line"><span>┌─────────────┬──────────────┬───┬─────────┬─────────────┬────────────────┬──────────────────────┬─────────┐</span></span>
<span class="line"><span>│        Name │       Entity │ N │   Scale │ Abs. limits │    Rel. limits │               Limits │ Lumping │</span></span>
<span class="line"><span>├─────────────┼──────────────┼───┼─────────┼─────────────┼────────────────┼──────────────────────┼─────────┤</span></span>
<span class="line"><span>│ WellIndices │ Perforations │ 5 │ default │  [0, 1e-06] │ [0.001, 1e+03] │ [2.04e-15, 4.29e-09] │       - │</span></span>
<span class="line"><span>└─────────────┴──────────────┴───┴─────────┴─────────────┴────────────────┴──────────────────────┴─────────┘</span></span>
<span class="line"><span>Parameters for INJECT2</span></span>
<span class="line"><span>┌─────────────┬──────────────┬───┬─────────┬─────────────┬────────────────┬──────────────────────┬─────────┐</span></span>
<span class="line"><span>│        Name │       Entity │ N │   Scale │ Abs. limits │    Rel. limits │               Limits │ Lumping │</span></span>
<span class="line"><span>├─────────────┼──────────────┼───┼─────────┼─────────────┼────────────────┼──────────────────────┼─────────┤</span></span>
<span class="line"><span>│ WellIndices │ Perforations │ 5 │ default │  [0, 1e-06] │ [0.001, 1e+03] │ [1.08e-14, 2.15e-08] │       - │</span></span>
<span class="line"><span>└─────────────┴──────────────┴───┴─────────┴─────────────┴────────────────┴──────────────────────┴─────────┘</span></span>
<span class="line"><span>#1: 3.737328643385503</span></span>
<span class="line"><span>Initial objective: 3.737328643385503, gradient norm 2.9837731832234324e6</span></span>
<span class="line"><span>RUNNING THE L-BFGS-B CODE</span></span>
<span class="line"><span></span></span>
<span class="line"><span>           * * *</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Machine precision = 2.220D-16</span></span>
<span class="line"><span> N =         9368     M =           20</span></span>
<span class="line"><span></span></span>
<span class="line"><span>At X0         0 variables are exactly at the bounds</span></span>
<span class="line"><span></span></span>
<span class="line"><span>At iterate    0    f=  3.73733D+00    |proj g|=  9.99001D-01</span></span>
<span class="line"><span>┌ Warning: Partial data passed, objective set to large value 37.37328643385503.</span></span>
<span class="line"><span>└ @ Jutul ~/.julia/packages/Jutul/YmYqR/src/ad/gradients.jl:682</span></span>
<span class="line"><span>#2: 37.37328643385503</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>#3: 65.02177037682802</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>\x1B[31;1mPROD1:\x1B[0m Approaching zero rate, disabling producer for current step</span></span>
<span class="line"><span>#4: 64.00313451303461</span></span>
<span class="line"><span>#5: 62.0261334204066</span></span>
<span class="line"><span>#6: 58.232045513269206</span></span>
<span class="line"><span>#7: 47.435802575767525</span></span>
<span class="line"><span>#8: 26.59660421819642</span></span>
<span class="line"><span>#9: 7.43905514078756</span></span>
<span class="line"><span>#10: 0.6073652972752315</span></span>
<span class="line"><span></span></span>
<span class="line"><span>At iterate    1    f=  6.07365D-01    |proj g|=  9.99000D-01</span></span>
<span class="line"><span>#11: 0.29312617801494656</span></span>
<span class="line"><span></span></span>
<span class="line"><span>At iterate    2    f=  2.93126D-01    |proj g|=  9.99000D-01</span></span>
<span class="line"><span>#12: 0.19241047832975253</span></span>
<span class="line"><span></span></span>
<span class="line"><span>At iterate    3    f=  1.92410D-01    |proj g|=  9.99000D-01</span></span>
<span class="line"><span>#13: 0.17230200116480296</span></span>
<span class="line"><span></span></span>
<span class="line"><span>At iterate    4    f=  1.72302D-01    |proj g|=  9.99000D-01</span></span>
<span class="line"><span>#14: 0.16527412538860745</span></span>
<span class="line"><span>#15: 0.14215791352595392</span></span>
<span class="line"><span></span></span>
<span class="line"><span>At iterate    5    f=  1.42158D-01    |proj g|=  9.99000D-01</span></span>
<span class="line"><span>#16: 0.12780257362502997</span></span>
<span class="line"><span>#17: 0.1260108438426492</span></span>
<span class="line"><span></span></span>
<span class="line"><span>At iterate    6    f=  1.26011D-01    |proj g|=  9.99001D-01</span></span>
<span class="line"><span>#18: 0.11893837026478023</span></span>
<span class="line"><span></span></span>
<span class="line"><span>At iterate    7    f=  1.18938D-01    |proj g|=  9.99006D-01</span></span>
<span class="line"><span>#19: 0.11367168067532847</span></span>
<span class="line"><span></span></span>
<span class="line"><span>At iterate    8    f=  1.13672D-01    |proj g|=  9.99006D-01</span></span>
<span class="line"><span>#20: 0.10834382427698824</span></span>
<span class="line"><span></span></span>
<span class="line"><span>At iterate    9    f=  1.08344D-01    |proj g|=  9.99008D-01</span></span>
<span class="line"><span>#21: 0.10200388474416905</span></span>
<span class="line"><span>#22: 0.10355601118950877</span></span>
<span class="line"><span></span></span>
<span class="line"><span>At iterate   10    f=  1.03556D-01    |proj g|=  9.99009D-01</span></span>
<span class="line"><span>#23: 0.13835646826674375</span></span>
<span class="line"><span>#24: 0.09408423048261311</span></span>
<span class="line"><span></span></span>
<span class="line"><span>At iterate   11    f=  9.40842D-02    |proj g|=  9.99008D-01</span></span>
<span class="line"><span>#25: 0.09395222519271512</span></span>
<span class="line"><span></span></span>
<span class="line"><span>At iterate   12    f=  9.39522D-02    |proj g|=  9.99012D-01</span></span>
<span class="line"><span></span></span>
<span class="line"><span>           * * *</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Tit   = total number of iterations</span></span>
<span class="line"><span>Tnf   = total number of function evaluations</span></span>
<span class="line"><span>Tnint = total number of segments explored during Cauchy searches</span></span>
<span class="line"><span>Skip  = number of BFGS updates skipped</span></span>
<span class="line"><span>Nact  = number of active bounds at final generalized Cauchy point</span></span>
<span class="line"><span>Projg = norm of the final projected gradient</span></span>
<span class="line"><span>F     = final function value</span></span>
<span class="line"><span></span></span>
<span class="line"><span>           * * *</span></span>
<span class="line"><span></span></span>
<span class="line"><span>   N    Tit     Tnf  Tnint  Skip  Nact     Projg        F</span></span>
<span class="line"><span> 9368     12     25   9379     0     0   9.990D-01   9.395D-02</span></span>
<span class="line"><span>  F =   9.3952225192715122E-002</span></span>
<span class="line"><span></span></span>
<span class="line"><span>CONVERGENCE: REL_REDUCTION_OF_F_&lt;=_FACTR*EPSMCH</span></span>
<span class="line"><span></span></span>
<span class="line"><span> Cauchy                time 3.860E-03 seconds.</span></span>
<span class="line"><span> Subspace minimization time 3.784E-03 seconds.</span></span>
<span class="line"><span> Line search           time 1.579E+02 seconds.</span></span>
<span class="line"><span></span></span>
<span class="line"><span> Total User time 1.608E+02 seconds.</span></span></code></pre></div><h3 id="Transfer-the-results-back" tabindex="-1">Transfer the results back <a class="header-anchor" href="#Transfer-the-results-back" aria-label="Permalink to &quot;Transfer the results back {#Transfer-the-results-back}&quot;">​</a></h3><p>The optimization is generic and works on a single long vector that represents all our active parameters. We can devectorize this vector back into the nested representation used by the model itself and simulate.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tuned_case </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> deepcopy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(opt_setup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:case</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">model_c </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> coarse_case</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">model</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">model_f </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fine_case</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">model</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">param_c </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> tuned_case</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">parameters</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> opt_setup</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">devectorize_variables!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(param_c, model_c, final_x, data[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:mapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], config </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">simulated_tuned </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> simulate_reservoir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(tuned_case, info_level </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h3 id="Plot-the-results-interactively" tabindex="-1">Plot the results interactively <a class="header-anchor" href="#Plot-the-results-interactively" aria-label="Permalink to &quot;Plot the results interactively {#Plot-the-results-interactively}&quot;">​</a></h3><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">using</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> GLMakie</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wells_f, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> simulated_fine</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wells_c, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> simulated_coarse</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wells_t, states_t, time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> simulated_tuned</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">plot_well_results</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([wells_f, wells_c, wells_t], time, names </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Fine&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CGNet-initial&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CGNet-tuned&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span></code></pre></div><p><img src="`+e+`" alt=""></p><h3 id="Create-a-function-to-compare-individual-wells" tabindex="-1">Create a function to compare individual wells <a class="header-anchor" href="#Create-a-function-to-compare-individual-wells" aria-label="Permalink to &quot;Create a function to compare individual wells {#Create-a-function-to-compare-individual-wells}&quot;">​</a></h3><p>We next compare individual wells to see how the optimization has affected the match between the coarse scale and fine scale. As we can see, we have reasonably good match between the original model with about 18,000 cells and the coarse model with about 3000 cells. Even better match could be possible by adding more coarse blocks, or also optimizing for example the relative permeability parameters for the coarse model.</p><p>We plot the water cut and total rate for the production wells, and the bottom hole pressure for the injection wells.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> plot_tuned_well</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(k, kw; lposition </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :lt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Figure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ax </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Axis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fig[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], title </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$k</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, xlabel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;days&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ylabel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$kw</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> wells_f</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">time</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">./</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">si_unit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:day</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> kw </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :wcut</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        F </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x[k, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:wrat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">./</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x[k, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:lrat</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    else</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        F </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> abs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.(x[k, kw])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    lines!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ax, t, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">F</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(wells_f), label </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Fine-scale&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    lines!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ax, t, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">F</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(wells_c), label </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Initial coarse&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    lines!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ax, t, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">F</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(wells_t), label </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Tuned coarse&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    axislegend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(position </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> lposition)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fig</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>plot_tuned_well (generic function with 1 method)</span></span></code></pre></div><h3 id="Plot-PROD1-water-cut" tabindex="-1">Plot PROD1 water cut <a class="header-anchor" href="#Plot-PROD1-water-cut" aria-label="Permalink to &quot;Plot PROD1 water cut {#Plot-PROD1-water-cut}&quot;">​</a></h3><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">plot_tuned_well</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:PROD1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:wcut</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><img src="`+h+'" alt=""></p><h3 id="Plot-PROD2-water-cut" tabindex="-1">Plot PROD2 water cut <a class="header-anchor" href="#Plot-PROD2-water-cut" aria-label="Permalink to &quot;Plot PROD2 water cut {#Plot-PROD2-water-cut}&quot;">​</a></h3><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">plot_tuned_well</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:PROD2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:wcut</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><img src="'+k+'" alt=""></p><h3 id="Plot-PROD4-water-cut" tabindex="-1">Plot PROD4 water cut <a class="header-anchor" href="#Plot-PROD4-water-cut" aria-label="Permalink to &quot;Plot PROD4 water cut {#Plot-PROD4-water-cut}&quot;">​</a></h3><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">plot_tuned_well</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:PROD4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:wcut</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><img src="'+r+'" alt=""></p><h3 id="Plot-PROD1-total-rate" tabindex="-1">Plot PROD1 total rate <a class="header-anchor" href="#Plot-PROD1-total-rate" aria-label="Permalink to &quot;Plot PROD1 total rate {#Plot-PROD1-total-rate}&quot;">​</a></h3><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">plot_tuned_well</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:PROD1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:rate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><img src="'+E+'" alt=""></p><h3 id="Plot-PROD2-total-rate" tabindex="-1">Plot PROD2 total rate <a class="header-anchor" href="#Plot-PROD2-total-rate" aria-label="Permalink to &quot;Plot PROD2 total rate {#Plot-PROD2-total-rate}&quot;">​</a></h3><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">plot_tuned_well</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:PROD2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:rate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><img src="'+d+'" alt=""></p><h3 id="Plot-PROD4-total-rate" tabindex="-1">Plot PROD4 total rate <a class="header-anchor" href="#Plot-PROD4-total-rate" aria-label="Permalink to &quot;Plot PROD4 total rate {#Plot-PROD4-total-rate}&quot;">​</a></h3><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">plot_tuned_well</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:PROD4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:rate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><img src="'+g+'" alt=""></p><h3 id="Plot-INJECT1-bhp" tabindex="-1">Plot INJECT1 bhp <a class="header-anchor" href="#Plot-INJECT1-bhp" aria-label="Permalink to &quot;Plot INJECT1 bhp {#Plot-INJECT1-bhp}&quot;">​</a></h3><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">plot_tuned_well</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:INJECT1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:bhp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, lposition </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :rt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><img src="'+c+'" alt=""></p><h3 id="Plot-INJECT4-bhp" tabindex="-1">Plot INJECT4 bhp <a class="header-anchor" href="#Plot-INJECT4-bhp" aria-label="Permalink to &quot;Plot INJECT4 bhp {#Plot-INJECT4-bhp}&quot;">​</a></h3><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">plot_tuned_well</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:INJECT4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:bhp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, lposition </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :rt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><img src="'+o+`" alt=""></p><h2 id="Plot-the-objective-evaluations-during-optimization" tabindex="-1">Plot the objective evaluations during optimization <a class="header-anchor" href="#Plot-the-objective-evaluations-during-optimization" aria-label="Permalink to &quot;Plot the objective evaluations during optimization {#Plot-the-objective-evaluations-during-optimization}&quot;">​</a></h2><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Figure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ys </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> log10</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">is </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> x</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ax1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Axis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fig[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], yscale </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ys, title </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Objective evaluations&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, xlabel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Iterations&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ylabel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Objective&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">plot!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ax1, opt_setup[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:obj_hist</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig</span></span></code></pre></div><p><img src="`+y+`" alt=""></p><h2 id="Plot-the-evoluation-of-scaled-parameters" tabindex="-1">Plot the evoluation of scaled parameters <a class="header-anchor" href="#Plot-the-evoluation-of-scaled-parameters" aria-label="Permalink to &quot;Plot the evoluation of scaled parameters {#Plot-the-evoluation-of-scaled-parameters}&quot;">​</a></h2><p>We show the difference between the initial and final values of the scaled parameters, as well as the lower bound.</p><p>JutulDarcy maps the parameters to a single vector for optimization with values that are approximately in the box limit range (0, 1). This is convenient for optimizers, but can also be useful when plotting the parameters, even if the units are not preserved in this visualization, only the magnitude.</p><div class="language-julia vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">julia</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Figure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(size </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">800</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">600</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ax1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Axis</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(fig[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], title </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Scaled parameters&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ylabel </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Scaled value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">scatter!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ax1, setup[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:x0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], label </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Initial X&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">scatter!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ax1, final_x, label </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Final X&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, markersize </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">lines!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ax1, setup[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:lower</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], label </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Lower bound&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">axislegend</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">trans </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:mapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:Reservoir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:Transmissibilities</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> plot_bracket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(v, k)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    start </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">offset</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    stop </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> v</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">offset</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">v</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">n</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    y0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> setup[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:lower</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][start]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    y1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> setup[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:lower</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][stop]</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    bracket!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ax1, start, y0, stop, y1,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    text </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">$k</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, offset </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, orientation </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> :down</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (k, v) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> pairs</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:mapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:Reservoir</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    plot_bracket</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(v, k)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ylims!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ax1, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.2</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">maximum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(final_x), </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nothing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fig</span></span></code></pre></div><p><img src="`+u+'" alt=""></p><h2 id="Example-on-GitHub" tabindex="-1">Example on GitHub <a class="header-anchor" href="#Example-on-GitHub" aria-label="Permalink to &quot;Example on GitHub {#Example-on-GitHub}&quot;">​</a></h2><p>If you would like to run this example yourself, it can be downloaded from the JutulDarcy.jl GitHub repository <a href="https://github.com/sintefmath/JutulDarcy.jl/blob/main/examples/cgnet_egg.jl" target="_blank" rel="noreferrer">as a script</a>, or as a <a href="https://github.com/sintefmath/JutulDarcy.jl/blob/gh-pages/dev/final_site/notebooks/cgnet_egg.ipynb" target="_blank" rel="noreferrer">Jupyter Notebook</a></p><hr><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl" target="_blank" rel="noreferrer">Literate.jl</a>.</em></p>',66)]))}const _=i(F,[["render",m]]);export{B as __pageData,_ as default};
