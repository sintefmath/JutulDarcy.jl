<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Intro to compositional flow · JutulDarcy.jl</title><meta name="title" content="Intro to compositional flow · JutulDarcy.jl"/><meta property="og:title" content="Intro to compositional flow · JutulDarcy.jl"/><meta property="twitter:title" content="Intro to compositional flow · JutulDarcy.jl"/><meta name="description" content="Documentation for JutulDarcy.jl."/><meta property="og:description" content="Documentation for JutulDarcy.jl."/><meta property="twitter:description" content="Documentation for JutulDarcy.jl."/><meta property="og:url" content="https://sintefmath.github.io/JutulDarcy.jl/examples/co2_brine_2d_vertical/"/><meta property="twitter:url" content="https://sintefmath.github.io/JutulDarcy.jl/examples/co2_brine_2d_vertical/"/><link rel="canonical" href="https://sintefmath.github.io/JutulDarcy.jl/examples/co2_brine_2d_vertical/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="JutulDarcy.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">JutulDarcy.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><span class="tocitem">Introduction</span><ul><li><a class="tocitem" href="../../">JutulDarcy.jl</a></li><li><a class="tocitem" href="../../man/intro/">Getting started</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../two_phase_gravity_segregation/">Gravity segregation</a></li><li><a class="tocitem" href="../two_phase_buckley_leverett/">Two-phase Buckley-Leverett</a></li><li><a class="tocitem" href="../two_phase_unstable_gravity/">Gravity circulation with CPR preconditioner</a></li><li><a class="tocitem" href="../wells_intro/">Intro to wells</a></li><li><a class="tocitem" href="../co2_sloped/">CO2 injection in saline aquifer</a></li><li><a class="tocitem" href="../data_input_file/">Simulating Eclipse/DATA input files</a></li><li><a class="tocitem" href="../five_spot_ensemble/">Quarter-five-spot with variation</a></li><li class="is-active"><a class="tocitem" href>Intro to compositional flow</a><ul class="internal"><li><a class="tocitem" href="#Set-up-mixture"><span>Set up mixture</span></a></li><li><a class="tocitem" href="#Set-up-domain-and-wells"><span>Set up domain and wells</span></a></li><li><a class="tocitem" href="#Define-system-and-realize-on-grid"><span>Define system and realize on grid</span></a></li><li><a class="tocitem" href="#Define-schedule"><span>Define schedule</span></a></li><li><a class="tocitem" href="#Once-the-simulation-is-done,-we-can-plot-the-states"><span>Once the simulation is done, we can plot the states</span></a></li><li><a class="tocitem" href="#Example-on-GitHub"><span>Example on GitHub</span></a></li></ul></li><li><a class="tocitem" href="../compositional_5components/">Compositional with five components</a></li><li><a class="tocitem" href="../optimize_simple_bl/">Parameter optimization of Buckley-Leverett</a></li><li><a class="tocitem" href="../validation_spe1/">Validation: SPE1</a></li><li><a class="tocitem" href="../validation_spe9/">Validation: SPE9</a></li><li><a class="tocitem" href="../validation_egg/">Validation: Egg</a></li><li><a class="tocitem" href="../validation_olympus_1/">Validation: OLYMPUS 1</a></li><li><a class="tocitem" href="../validation_norne_nohyst/">Validation: Norne</a></li><li><a class="tocitem" href="../validation_mrst/">Validation: MRST input files</a></li></ul></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../man/highlevel/">High-level API</a></li><li><a class="tocitem" href="../../man/basics/input_files/">Input formats</a></li><li><a class="tocitem" href="../../man/basics/forces/">Driving forces</a></li><li><a class="tocitem" href="../../man/basics/systems/">Supported physical systems</a></li><li><a class="tocitem" href="../../man/basics/wells/">Wells and controls</a></li><li><a class="tocitem" href="../../man/basics/solution/">Solving the equations</a></li><li><a class="tocitem" href="../../man/basics/primary/">Primary variables</a></li><li><a class="tocitem" href="../../man/basics/secondary/">Secondary variables (properties)</a></li><li><a class="tocitem" href="../../man/basics/parameters/">Parameters</a></li><li><a class="tocitem" href="../../man/basics/plotting/">Plotting and visualization</a></li></ul></li><li><span class="tocitem">Advanced usage</span><ul><li><a class="tocitem" href="../../man/advanced/mpi/">Multi-threading and MPI support</a></li><li><a class="tocitem" href="../../man/advanced/compiled/">Standalone reservoir simulator</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../../ref/jutul/">Jutul functions</a></li></ul></li><li><span class="tocitem">Additional information </span><ul><li><a class="tocitem" href="../../extras/refs/">References</a></li><li><a class="tocitem" href="../../extras/faq/">FAQ</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Intro to compositional flow</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Intro to compositional flow</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/sintefmath/JutulDarcy.jl/blob/main/examples/co2_brine_2d_vertical.jl#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Example-demonstrating-compositional-flow"><a class="docs-heading-anchor" href="#Example-demonstrating-compositional-flow">Example demonstrating compositional flow</a><a id="Example-demonstrating-compositional-flow-1"></a><a class="docs-heading-anchor-permalink" href="#Example-demonstrating-compositional-flow" title="Permalink"></a></h1><p>This is a simple conceptual example demonstrating how to solve compositional flow. This example uses a two-component water-CO2 system. Note that the default Peng-Robinson is not accurate for this system without adjustments to the parameters. However, the example demonstrates the conceptual workflow for getting started with compositional simulation.</p><h2 id="Set-up-mixture"><a class="docs-heading-anchor" href="#Set-up-mixture">Set up mixture</a><a id="Set-up-mixture-1"></a><a class="docs-heading-anchor-permalink" href="#Set-up-mixture" title="Permalink"></a></h2><p>We load the external flash package and define a two-component H2O-CO2 system. The constructor for each species takes in molecular weight, critical pressure, critical temperature, critical volume, acentric factor given as strict SI. This means, for instance, that molar masses are given in kg/mole and not g/mole or kg/kmol.</p><pre><code class="language-julia hljs">using MultiComponentFlash
h2o = MolecularProperty(0.018015268, 22.064e6, 647.096, 5.595e-05, 0.3442920843)
co2 = MolecularProperty(0.0440098, 7.3773e6, 304.1282, 9.412e-05, 0.22394)

bic = zeros(2, 2)

mixture = MultiComponentMixture([h2o, co2], A_ij = bic, names = [&quot;H2O&quot;, &quot;CO2&quot;])
eos = GenericCubicEOS(mixture, PengRobinson())</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MultiComponentFlash.GenericCubicEOS{MultiComponentFlash.PengRobinson, Float64, 2, Nothing}(MultiComponentFlash.PengRobinson(), MultiComponentFlash.MultiComponentMixture{Float64, 2}(&quot;UnnamedMixture&quot;, [&quot;H2O&quot;, &quot;CO2&quot;], (MultiComponentFlash.MolecularProperty{Float64}(0.018015268, 2.2064e7, 647.096, 5.595e-5, 0.3442920843), MultiComponentFlash.MolecularProperty{Float64}(0.0440098, 7.3773e6, 304.1282, 9.412e-5, 0.22394)), [0.0 0.0; 0.0 0.0]), 2.414213562373095, -0.41421356237309515, 0.457235529, 0.077796074, nothing)</code></pre><h2 id="Set-up-domain-and-wells"><a class="docs-heading-anchor" href="#Set-up-domain-and-wells">Set up domain and wells</a><a id="Set-up-domain-and-wells-1"></a><a class="docs-heading-anchor-permalink" href="#Set-up-domain-and-wells" title="Permalink"></a></h2><pre><code class="language-julia hljs">using Jutul, JutulDarcy, GLMakie
nx = 50
ny = 1
nz = 20
dims = (nx, ny, nz)
g = CartesianMesh(dims, (100.0, 10.0, 10.0))
nc = number_of_cells(g)
Darcy, bar, kg, meter, Kelvin, day, sec = si_units(:darcy, :bar, :kilogram, :meter, :Kelvin, :day, :second)
K = repeat([0.1, 0.1, 0.001]*Darcy, 1, nc)
res = reservoir_domain(g, porosity = 0.3, permeability = K)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">DataDomain wrapping CartesianMesh (3D) with 50x1x20=1000 cells with 17 data fields added:
  1000 Cells
    :permeability =&gt; 3×1000 Matrix{Float64}
    :porosity =&gt; 1000 Vector{Float64}
    :rock_thermal_conductivity =&gt; 1000 Vector{Float64}
    :fluid_thermal_conductivity =&gt; 1000 Vector{Float64}
    :rock_density =&gt; 1000 Vector{Float64}
    :cell_centroids =&gt; 3×1000 Matrix{Float64}
    :volumes =&gt; 1000 Vector{Float64}
  1930 Faces
    :neighbors =&gt; 2×1930 Matrix{Int64}
    :areas =&gt; 1930 Vector{Float64}
    :normals =&gt; 3×1930 Matrix{Float64}
    :face_centroids =&gt; 3×1930 Matrix{Float64}
  3860 HalfFaces
    :half_face_cells =&gt; 3860 Vector{Int64}
    :half_face_faces =&gt; 3860 Vector{Int64}
  2140 BoundaryFaces
    :boundary_areas =&gt; 2140 Vector{Float64}
    :boundary_centroids =&gt; 3×2140 Matrix{Float64}
    :boundary_normals =&gt; 3×2140 Matrix{Float64}
    :boundary_neighbors =&gt; 2140 Vector{Int64}
</code></pre><p>Set up a vertical well in the first corner, perforated in top layer</p><pre><code class="language-julia hljs">prod = setup_well(g, K, [(nx, ny, 1)], name = :Producer)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MultiSegmentWell [Producer] (2 nodes, 1 segments, 1 perforations)</code></pre><p>Set up an injector in the opposite corner, perforated in bottom layer</p><pre><code class="language-julia hljs">inj = setup_well(g, K, [(1, 1, nz)], name = :Injector)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MultiSegmentWell [Injector] (2 nodes, 1 segments, 1 perforations)</code></pre><h2 id="Define-system-and-realize-on-grid"><a class="docs-heading-anchor" href="#Define-system-and-realize-on-grid">Define system and realize on grid</a><a id="Define-system-and-realize-on-grid-1"></a><a class="docs-heading-anchor-permalink" href="#Define-system-and-realize-on-grid" title="Permalink"></a></h2><pre><code class="language-julia hljs">rhoLS = 844.23*kg/meter^3
rhoVS = 126.97*kg/meter^3
rhoS = [rhoLS, rhoVS]
L, V = LiquidPhase(), VaporPhase()
sys = MultiPhaseCompositionalSystemLV(eos, (L, V))
model, parameters = setup_reservoir_model(res, sys, wells = [inj, prod]);
push!(model[:Reservoir].output_variables, :Saturations)
kr = BrooksCoreyRelativePermeabilities(sys, 2.0, 0.0, 1.0)
model = replace_variables!(model, RelativePermeabilities = kr)
T0 = repeat([303.15*Kelvin], 1, nc)
parameters[:Reservoir][:Temperature] = T0
state0 = setup_reservoir_state(model, Pressure = 50*bar, OverallMoleFractions = [1.0, 0.0]);</code></pre><h2 id="Define-schedule"><a class="docs-heading-anchor" href="#Define-schedule">Define schedule</a><a id="Define-schedule-1"></a><a class="docs-heading-anchor-permalink" href="#Define-schedule" title="Permalink"></a></h2><p>5 year (5*365.24 days) simulation period</p><pre><code class="language-julia hljs">dt0 = repeat([1]*day, 26)
dt1 = repeat([10.0]*day, 180)
dt = append!(dt0, dt1)
rate_target = TotalRateTarget(9.5066e-06*meter^3/sec)
I_ctrl = InjectorControl(rate_target, [0, 1], density = rhoVS)
bhp_target = BottomHolePressureTarget(50*bar)
P_ctrl = ProducerControl(bhp_target)

controls = Dict()
controls[:Injector] = I_ctrl
controls[:Producer] = P_ctrl
forces = setup_reservoir_forces(model, control = controls)
ws, states = simulate_reservoir(state0, model, dt, parameters = parameters, forces = forces)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ReservoirSimResult with 206 entries:

  wells (2 present):
    :Producer
    :Injector
    Results per well:
       :H2O_mass_rate =&gt; Vector{Float64} of size (206,)
       :lrat =&gt; Vector{Float64} of size (206,)
       :orat =&gt; Vector{Float64} of size (206,)
       :control =&gt; Vector{Symbol} of size (206,)
       :bhp =&gt; Vector{Float64} of size (206,)
       :CO2_mass_rate =&gt; Vector{Float64} of size (206,)
       :mass_rate =&gt; Vector{Float64} of size (206,)
       :rate =&gt; Vector{Float64} of size (206,)
       :grat =&gt; Vector{Float64} of size (206,)

  states (Vector with 206 entries, reservoir variables for each state)
    :LiquidMassFractions =&gt; Matrix{Float64} of size (2, 1000)
    :OverallMoleFractions =&gt; Matrix{Float64} of size (2, 1000)
    :Saturations =&gt; Matrix{Float64} of size (2, 1000)
    :Pressure =&gt; Vector{Float64} of size (1000,)
    :VaporMassFractions =&gt; Matrix{Float64} of size (2, 1000)
    :TotalMasses =&gt; Matrix{Float64} of size (2, 1000)

  time (report time for each state)
     Vector{Float64} of length 206

  result (extended states, reports)
     SimResult with 206 entries

  extra
     Dict{Any, Any} with keys :simulator, :config

  Completed at Aug. 31 2024 20:08 after 5 seconds, 118 milliseconds, 42.47 microseconds.</code></pre><h2 id="Once-the-simulation-is-done,-we-can-plot-the-states"><a class="docs-heading-anchor" href="#Once-the-simulation-is-done,-we-can-plot-the-states">Once the simulation is done, we can plot the states</a><a id="Once-the-simulation-is-done,-we-can-plot-the-states-1"></a><a class="docs-heading-anchor-permalink" href="#Once-the-simulation-is-done,-we-can-plot-the-states" title="Permalink"></a></h2><p>Note that this example is intended for static publication in the documentation. For interactive visualization you can use functions like <code>plot_interactive</code> to interactively visualize the states.</p><pre><code class="language-julia hljs">z = states[end][:OverallMoleFractions][2, :]
function plot_vertical(x, t)
    data = reshape(x, (nx, nz))
    data = data[:, end:-1:1]
    fig, ax, plot = heatmap(data)
    ax.title = t
    Colorbar(fig[1, 2], plot)
    fig
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">plot_vertical (generic function with 1 method)</code></pre><h3 id="Plot-final-CO2-mole-fraction"><a class="docs-heading-anchor" href="#Plot-final-CO2-mole-fraction">Plot final CO2 mole fraction</a><a id="Plot-final-CO2-mole-fraction-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-final-CO2-mole-fraction" title="Permalink"></a></h3><pre><code class="language-julia hljs">plot_vertical(z, &quot;CO2&quot;)</code></pre><img src="8a2c1a5b.png" alt="Example block output"/><h3 id="Plot-final-vapor-saturation"><a class="docs-heading-anchor" href="#Plot-final-vapor-saturation">Plot final vapor saturation</a><a id="Plot-final-vapor-saturation-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-final-vapor-saturation" title="Permalink"></a></h3><pre><code class="language-julia hljs">sg = states[end][:Saturations][2, :]
plot_vertical(sg, &quot;Vapor saturation&quot;)</code></pre><img src="14789161.png" alt="Example block output"/><h3 id="Plot-final-pressure"><a class="docs-heading-anchor" href="#Plot-final-pressure">Plot final pressure</a><a id="Plot-final-pressure-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-final-pressure" title="Permalink"></a></h3><pre><code class="language-julia hljs">p = states[end][:Pressure]
plot_vertical(p./bar, &quot;Pressure [bar]&quot;)</code></pre><img src="6de1036a.png" alt="Example block output"/><h3 id="Plot-in-interactive-viewer"><a class="docs-heading-anchor" href="#Plot-in-interactive-viewer">Plot in interactive viewer</a><a id="Plot-in-interactive-viewer-1"></a><a class="docs-heading-anchor-permalink" href="#Plot-in-interactive-viewer" title="Permalink"></a></h3><pre><code class="language-julia hljs">plot_reservoir(model, states, step = length(dt), key = :Saturations)</code></pre><img src="fa10f78e.png" alt="Example block output"/><h2 id="Example-on-GitHub"><a class="docs-heading-anchor" href="#Example-on-GitHub">Example on GitHub</a><a id="Example-on-GitHub-1"></a><a class="docs-heading-anchor-permalink" href="#Example-on-GitHub" title="Permalink"></a></h2><p>If you would like to run this example yourself, it can be downloaded from the JutulDarcy.jl GitHub repository <a href="https://github.com/sintefmath/JutulDarcy.jl/blob/main/examples/co2_brine_2d_vertical.jl">as a script</a>, or as a <a href="https://github.com/sintefmath/JutulDarcy.jl/blob/gh-pages/dev/examples/co2_brine_2d_vertical.ipynb">Notebook</a></p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../five_spot_ensemble/">« Quarter-five-spot with variation</a><a class="docs-footer-nextpage" href="../compositional_5components/">Compositional with five components »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.6.0 on <span class="colophon-date" title="Saturday 31 August 2024 21:05">Saturday 31 August 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
