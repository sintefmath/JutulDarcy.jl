<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>High-level functions · JutulDarcy.jl</title><meta name="title" content="High-level functions · JutulDarcy.jl"/><meta property="og:title" content="High-level functions · JutulDarcy.jl"/><meta property="twitter:title" content="High-level functions · JutulDarcy.jl"/><meta name="description" content="Documentation for JutulDarcy.jl."/><meta property="og:description" content="Documentation for JutulDarcy.jl."/><meta property="twitter:description" content="Documentation for JutulDarcy.jl."/><meta property="og:url" content="https://sintefmath.github.io/JutulDarcy.jl/man/highlevel/"/><meta property="twitter:url" content="https://sintefmath.github.io/JutulDarcy.jl/man/highlevel/"/><link rel="canonical" href="https://sintefmath.github.io/JutulDarcy.jl/man/highlevel/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="JutulDarcy.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">JutulDarcy.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../intro/">Getting started</a></li><li class="is-active"><a class="tocitem" href>High-level functions</a><ul class="internal"><li><a class="tocitem" href="#Setup"><span>Setup</span></a></li><li><a class="tocitem" href="#Simulation"><span>Simulation</span></a></li></ul></li><li><a class="tocitem" href="../input_files/">Input files</a></li><li><a class="tocitem" href="../forces/">Driving forces</a></li><li><a class="tocitem" href="../systems/">Supported physical systems</a></li><li><a class="tocitem" href="../wells/">Wells and controls</a></li><li><a class="tocitem" href="../solution/">Solving the equations</a></li><li><a class="tocitem" href="../primary/">Primary variables</a></li><li><a class="tocitem" href="../secondary/">Secondary variables (properties)</a></li><li><a class="tocitem" href="../parameters/">Parameters</a></li><li><a class="tocitem" href="../plotting/">Visualization</a></li></ul></li><li><span class="tocitem">Advanced usage</span><ul><li><a class="tocitem" href="../mpi/">Parallel solves with MPI</a></li><li><a class="tocitem" href="../compiled/">JutulDarcy.jl compiled app</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/intro/">Getting started</a></li><li><a class="tocitem" href="../../examples/two_phase_gravity_segregation/">Gravity segregation</a></li><li><a class="tocitem" href="../../examples/two_phase_buckley_leverett/">Two-phase Buckley-Leverett</a></li><li><a class="tocitem" href="../../examples/two_phase_unstable_gravity/">Gravity circulation with CPR preconditioner</a></li><li><a class="tocitem" href="../../examples/wells_intro/">Intro to wells</a></li><li><a class="tocitem" href="../../examples/five_spot_ensemble/">Quarter-five-spot with variation</a></li><li><a class="tocitem" href="../../examples/co2_brine_2d_vertical/">Intro to compositional flow</a></li><li><a class="tocitem" href="../../examples/compositional_5components/">Compositional with five components</a></li><li><a class="tocitem" href="../../examples/optimize_simple_bl/">Parameter optimization of Buckley-Leverett</a></li><li><a class="tocitem" href="../../examples/mrst_validation/">Validation of reservoir simulator</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../../ref/jutul/">Jutul functions</a></li></ul></li><li><span class="tocitem">Additional information </span><ul><li><a class="tocitem" href="../../extras/refs/">References</a></li><li><a class="tocitem" href="../../extras/faq/">FAQ</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>High-level functions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>High-level functions</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/sintefmath/JutulDarcy.jl/blob/main/docs/src/man/highlevel.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="High-level-API"><a class="docs-heading-anchor" href="#High-level-API">High-level API</a><a id="High-level-API-1"></a><a class="docs-heading-anchor-permalink" href="#High-level-API" title="Permalink"></a></h1><h2 id="Setup"><a class="docs-heading-anchor" href="#Setup">Setup</a><a id="Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Setup" title="Permalink"></a></h2><h3 id="Meshes"><a class="docs-heading-anchor" href="#Meshes">Meshes</a><a id="Meshes-1"></a><a class="docs-heading-anchor-permalink" href="#Meshes" title="Permalink"></a></h3><h3 id="Reservoir"><a class="docs-heading-anchor" href="#Reservoir">Reservoir</a><a id="Reservoir-1"></a><a class="docs-heading-anchor-permalink" href="#Reservoir" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JutulDarcy.reservoir_domain" href="#JutulDarcy.reservoir_domain"><code>JutulDarcy.reservoir_domain</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">reservoir_domain(g; permeability = convert_to_si(0.1, :darcy), porosity = 0.1, kwarg...)</code></pre><p>Set up a <code>DataDomain</code> instance for given mesh or other representation <code>g</code>. <code>permeability</code> and <code>porosity</code> are then added to the domain. If scalars are passed, they are expanded to cover all cells. Arrays are asserted to match all cells. Permeability is either one value per cell (diagonal scalar), one value per dimension given in each row (for a diagonal tensor) or a vector that represents a compact full tensor representation (6 elements in 3D, 3 in 2D).</p><p><strong>Default data and their values</strong></p><table><tr><th style="text-align: right">Name</th><th style="text-align: right">Explanation</th><th style="text-align: right">Unit</th><th style="text-align: right">Default</th></tr><tr><td style="text-align: right"><code>permeability</code></td><td style="text-align: right">Rock ability to conduct fluid flow</td><td style="text-align: right"><span>$m^2$</span></td><td style="text-align: right">100 mD</td></tr><tr><td style="text-align: right"><code>porosity</code></td><td style="text-align: right">Rock void fraction open to flow (0 to 1)</td><td style="text-align: right">-</td><td style="text-align: right">0.3</td></tr><tr><td style="text-align: right"><code>rock_density</code></td><td style="text-align: right">Mass density of rock</td><td style="text-align: right"><span>$kg^3/m^3$</span></td><td style="text-align: right">2000.0</td></tr><tr><td style="text-align: right"><code>rock_heat_capacity</code></td><td style="text-align: right">Specific heat capacity of rock</td><td style="text-align: right"><span>$J/(kg K)$</span></td><td style="text-align: right">900.0</td></tr><tr><td style="text-align: right"><code>rock_thermal_conductivity</code></td><td style="text-align: right">Heat conductivity of rock</td><td style="text-align: right"><span>$W/m K$</span></td><td style="text-align: right">3.0</td></tr><tr><td style="text-align: right"><code>fluid_thermal_conductivity</code></td><td style="text-align: right">Heat conductivity of fluid phases</td><td style="text-align: right"><span>$W/m K$</span></td><td style="text-align: right">0.6</td></tr><tr><td style="text-align: right"><code>component_heat_capacity</code></td><td style="text-align: right">Specific heat capacity of fluid components</td><td style="text-align: right"><span>$J/(kg K)$</span></td><td style="text-align: right">4184.0</td></tr></table><p>Note that the default values are taken to be roughly those of water for fluid phases and sandstone for those of rock. Choice of values can severely impact your simulation results - take care to check the values that your physical system makes use of!</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/1da38ce2ec55473697f93d6bc3335b019147df6d/src/utils.jl#L20-L46">source</a></section><section><div><pre><code class="language-julia hljs">reservoir_domain(m::Union{SimulationModel, MultiModel})</code></pre><p>Get reservoir domain embedded in model.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/1da38ce2ec55473697f93d6bc3335b019147df6d/src/utils.jl#L79-L83">source</a></section><section><div><pre><code class="language-julia hljs">reservoir_domain(case::JutulCase)</code></pre><p>Get reservoir domain from a reservoir simulation case.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/1da38ce2ec55473697f93d6bc3335b019147df6d/src/utils.jl#L89-L93">source</a></section></article><h3 id="Wells"><a class="docs-heading-anchor" href="#Wells">Wells</a><a id="Wells-1"></a><a class="docs-heading-anchor-permalink" href="#Wells" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JutulDarcy.setup_well" href="#JutulDarcy.setup_well"><code>JutulDarcy.setup_well</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">setup_well(D::DataDomain, reservoir_cells; skin = 0.0, Kh = nothing, radius = 0.1, dir = :z)</code></pre><p>Set up a well in <code>reservoir_cells</code> with given skin factor and radius. The order of cells matter as it is treated as a trajectory.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/1da38ce2ec55473697f93d6bc3335b019147df6d/src/facility/wells/wells.jl#L64-L69">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JutulDarcy.setup_vertical_well" href="#JutulDarcy.setup_vertical_well"><code>JutulDarcy.setup_vertical_well</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">setup_vertical_well(D::DataDomain, i, j; &lt;kwarg&gt;)</code></pre><p>Set up a vertical well with a <code>DataDomain</code> input that represents the porous medium / reservoir where the wells it to be placed.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/1da38ce2ec55473697f93d6bc3335b019147df6d/src/facility/wells/wells.jl#L178-L183">source</a></section><section><div><pre><code class="language-julia hljs">setup_vertical_well(g, K, i, j; heel = 1, toe = grid_dims_ijk(g)[3], kwarg...)</code></pre><p>Set up a vertical well for given grid <code>g</code> and permeability <code>K</code> at logical indices <code>i, j</code> perforating all cells starting at k-logical index <code>heel</code> to <code>toe</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/1da38ce2ec55473697f93d6bc3335b019147df6d/src/facility/wells/wells.jl#L190-L196">source</a></section></article><h3 id="Model"><a class="docs-heading-anchor" href="#Model">Model</a><a id="Model-1"></a><a class="docs-heading-anchor-permalink" href="#Model" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JutulDarcy.setup_reservoir_model" href="#JutulDarcy.setup_reservoir_model"><code>JutulDarcy.setup_reservoir_model</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">setup_reservoir_model(reservoir, system; wells = [], &lt;keyword arguments&gt;)
setup_reservoir_model(reservoir, system; wells = [], context = DefaultContext(), reservoir_context = nothing, backend = :csc, &lt;keyword arguments&gt;)</code></pre><p>Set up a reservoir <code>MultiModel</code> for a given reservoir <code>DataDomain</code> typically set up from  <a href="#JutulDarcy.reservoir_domain"><code>reservoir_domain</code></a> and an optional vector of wells that are created using <a href="#JutulDarcy.setup_vertical_well"><code>setup_vertical_well</code></a> and  <a href="#JutulDarcy.setup_well"><code>setup_well</code></a>.</p><p>The routine automatically sets up a facility and couples the wells with the reservoir and that facility.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/1da38ce2ec55473697f93d6bc3335b019147df6d/src/utils.jl#L129-L139">source</a></section></article><h3 id="Initial-state"><a class="docs-heading-anchor" href="#Initial-state">Initial state</a><a id="Initial-state-1"></a><a class="docs-heading-anchor-permalink" href="#Initial-state" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JutulDarcy.setup_reservoir_state" href="#JutulDarcy.setup_reservoir_state"><code>JutulDarcy.setup_reservoir_state</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">setup_reservoir_state(model, &lt;keyword arguments&gt;)
# Ex: For immiscible two-phase
setup_reservoir_state(model, Pressure = 1e5, Saturations = [0.2, 0.8])</code></pre><p>Convenience constructor that initializes a state for a <code>MultiModel</code> set up using <a href="#JutulDarcy.setup_reservoir_model"><code>setup_reservoir_model</code></a>. The main convenience over <a href="../../ref/jutul/#Jutul.setup_state-Tuple{JutulModel, Vararg{Any}}"><code>setup_state</code></a> is only the reservoir initialization values need be provided: wells are automatically initialized from the connected reservoir cells.</p><p>As an alternative to passing keyword arguments, a <code>Dict{Symbol, Any}</code> instance can be sent in as a second, non-keyword argument.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/1da38ce2ec55473697f93d6bc3335b019147df6d/src/utils.jl#L656-L668">source</a></section></article><h4 id="Why-is-initialization-needed?"><a class="docs-heading-anchor" href="#Why-is-initialization-needed?">Why is initialization needed?</a><a id="Why-is-initialization-needed?-1"></a><a class="docs-heading-anchor-permalink" href="#Why-is-initialization-needed?" title="Permalink"></a></h4><h4 id="Simple-initialization"><a class="docs-heading-anchor" href="#Simple-initialization">Simple initialization</a><a id="Simple-initialization-1"></a><a class="docs-heading-anchor-permalink" href="#Simple-initialization" title="Permalink"></a></h4><h4 id="Hydrostatic-equilibriation"><a class="docs-heading-anchor" href="#Hydrostatic-equilibriation">Hydrostatic equilibriation</a><a id="Hydrostatic-equilibriation-1"></a><a class="docs-heading-anchor-permalink" href="#Hydrostatic-equilibriation" title="Permalink"></a></h4><h2 id="Simulation"><a class="docs-heading-anchor" href="#Simulation">Simulation</a><a id="Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Simulation" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JutulDarcy.simulate_reservoir" href="#JutulDarcy.simulate_reservoir"><code>JutulDarcy.simulate_reservoir</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">simulate_reservoir(state0, model, dt;
    parameters = setup_parameters(model),
    restart = false,
    forces = setup_forces(model),
    kwarg...
)
simulate_reservoir(case;
    kwarg...
)</code></pre><p>Convenience function for simulating a reservoir model. This function internally calls <a href="#JutulDarcy.setup_reservoir_simulator"><code>setup_reservoir_simulator</code></a>, simulates the problem and returns a <a href="@ref"><code>ReservoirSimResult</code></a>.</p><p>You can optionally unpack this result into the most typical desired outputs:</p><p><code>wellsols, states = simulate_reservoir(...)</code></p><p>where <code>wellsols</code> contains the well results and <code>states</code> the reservoir results (pressure, saturations and so on, in each cell of the reservoir domain).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/1da38ce2ec55473697f93d6bc3335b019147df6d/src/utils.jl#L437-L458">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="JutulDarcy.setup_reservoir_simulator" href="#JutulDarcy.setup_reservoir_simulator"><code>JutulDarcy.setup_reservoir_simulator</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">setup_reservoir_simulator(models, initializer, parameters = nothing; &lt;keyword arguments&gt;)</code></pre><p><strong>Arguments</strong></p><ul><li><code>models</code>: either a single model or a Dict with the key :Reservoir for multimodels</li><li><code>initializer</code>: used to setup state0, must be compatible with <code>model</code></li><li><code>parameters</code>: initialized parameters, must be compatible with <code>model</code> if provided</li><li><code>linear_solver=:bicgstab</code>: iterative solver to use (provided model supports it)</li><li><code>precond=:cpr</code>: preconditioner for iterative solver: Either :cpr or :ilu0.</li><li><code>rtol=1e-3</code>: relative tolerance for linear solver</li><li><code>initial_dt=3600*24.0</code>: initial time-step in seconds (one day by default)</li><li><code>target_its=8</code>: target number of nonlinear iterations per time step</li><li><code>offset_its=1</code>: dampening parameter for time step selector where larger values lead to more pessimistic estimates.</li><li><code>tol_cnv=1e-3</code>: maximum allowable point-wise error (volume-balance)</li><li><code>tol_mb=1e-7</code>: maximum alllowable integrated error (mass-balance)</li><li><code>specialize=false</code>: use deep specialization of storage for faster execution, but significantly more compile time</li></ul><p>Additional keyword arguments are passed onto <a href="../../ref/jutul/#Jutul.simulator_config-Tuple{Any}"><code>simulator_config</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/sintefmath/JutulDarcy.jl/blob/1da38ce2ec55473697f93d6bc3335b019147df6d/src/utils.jl#L275-L293">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../intro/">« Getting started</a><a class="docs-footer-nextpage" href="../input_files/">Input files »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.3.0 on <span class="colophon-date" title="Monday 4 March 2024 19:17">Monday 4 March 2024</span>. Using Julia version 1.10.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
